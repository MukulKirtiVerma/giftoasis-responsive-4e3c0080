
{% extends 'base.html' %}

{% block title %}Add Gift - GiftOasis{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="mb-6">
            <a href="{{ url_for('wishlist_detail', wishlist_id=wishlist.id) }}" class="text-blue-600 hover:text-blue-700 flex items-center">
                <span class="mr-2">‚Üê</span> Back to {{ wishlist.name }}
            </a>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-6">Add a Gift</h1>
                
                <ul class="flex border-b mb-6">
                    <li class="mr-1">
                        <a href="#url" class="inline-block px-4 py-2 bg-white rounded-t border-l border-t border-r {% if from_url %}text-blue-600 border-b-2 border-blue-600 font-medium{% else %}text-gray-500 hover:text-gray-700{% endif %}" id="url-tab">
                            Copy/Paste URL
                        </a>
                    </li>
                    <li class="mr-1">
                        <a href="#manual" class="inline-block px-4 py-2 bg-white rounded-t border-l border-t border-r {% if not from_url %}text-blue-600 border-b-2 border-blue-600 font-medium{% else %}text-gray-500 hover:text-gray-700{% endif %}" id="manual-tab">
                            Create a Gift
                        </a>
                    </li>
                </ul>
                
                <div id="url-form" class="{% if not from_url %}hidden{% endif %}">
                    <form method="POST" action="{{ url_for('add_gift_from_url', wishlist_id=wishlist.id) }}">
                        {{ url_form.hidden_tag() }}
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Paste a Link from Anywhere on the Web</label>
                            {{ url_form.url(class="w-full border border-gray-300 rounded px-4 py-2", placeholder="https://") }}
                            {% if url_form.url.errors %}
                                <div class="text-red-500 text-sm mt-1">
                                    {% for error in url_form.url.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 text-yellow-400">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        For a super easy way to add gifts, get the 
                                        <a href="#" class="font-medium underline text-yellow-700 hover:text-yellow-600">
                                            Gift Hero browser extension
                                        </a>.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <a href="{{ url_for('wishlist_detail', wishlist_id=wishlist.id) }}" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">
                                Cancel
                            </a>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
                                Next
                            </button>
                        </div>
                    </form>
                </div>
                
                <div id="manual-form" class="{% if from_url %}hidden{% endif %}">
                    <form method="POST" action="{{ url_for('add_gift', wishlist_id=wishlist.id) }}" enctype="multipart/form-data">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Gift Name</label>
                            {{ form.name(class="w-full border border-gray-300 rounded px-4 py-2") }}
                            {% if form.name.errors %}
                                <div class="text-red-500 text-sm mt-1">
                                    {% for error in form.name.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Price</label>
                            <div class="flex items-center">
                                <span class="mr-2">$</span>
                                {{ form.price(class="border border-gray-300 rounded px-4 py-2 w-1/3") }}
                                <select class="ml-2 border border-gray-300 rounded px-4 py-2 w-1/4">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                </select>
                            </div>
                            {% if form.price.errors %}
                                <div class="text-red-500 text-sm mt-1">
                                    {% for error in form.price.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Gift Details <span class="text-gray-500 text-sm">(Optional)</span></label>
                            {{ form.description(class="w-full border border-gray-300 rounded px-4 py-2 h-24", placeholder="For example: 'the blue one' or 'medium size', etc.") }}
                            {% if form.description.errors %}
                                <div class="text-red-500 text-sm mt-1">
                                    {% for error in form.description.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Link <span class="text-gray-500 text-sm">(Optional)</span></label>
                            {{ form.source_url(class="w-full border border-gray-300 rounded px-4 py-2", placeholder="https://") }}
                            {% if form.source_url.errors %}
                                <div class="text-red-500 text-sm mt-1">
                                    {% for error in form.source_url.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Image</label>
                            <div class="border border-dashed border-gray-300 rounded p-6 text-center">
                                <div id="image-preview" class="mb-4 hidden">
                                    <img id="preview-image" src="" alt="Preview" class="mx-auto h-48 object-contain">
                                    <button type="button" id="remove-image" class="text-blue-600 hover:underline mt-2">Remove file</button>
                                </div>
                                <div id="upload-prompt">
                                    <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-2"></i>
                                    <p class="text-gray-500">Upload an image or paste an image URL</p>
                                    <div class="mt-4">
                                        <label for="file-upload" class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded inline-block">
                                            Choose file
                                        </label>
                                        <input id="file-upload" type="file" class="hidden" accept="image/*">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-gray-700 mb-2">Priority</label>
                            <div class="flex space-x-4">
                                {% for value, label in form.priority.choices %}
                                <div>
                                    <input type="radio" name="priority" id="priority-{{ value }}" value="{{ value }}" 
                                           {% if form.priority.data == value %}checked{% endif %}
                                           class="hidden peer">
                                    <label for="priority-{{ value }}" 
                                           class="block border border-gray-300 rounded px-4 py-2 cursor-pointer
                                                  peer-checked:bg-blue-50 peer-checked:border-blue-500 peer-checked:text-blue-600">
                                        {{ label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <a href="{{ url_for('wishlist_detail', wishlist_id=wishlist.id) }}" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">
                                Cancel
                            </a>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
                                Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlTab = document.getElementById('url-tab');
        const manualTab = document.getElementById('manual-tab');
        const urlForm = document.getElementById('url-form');
        const manualForm = document.getElementById('manual-form');
        
        urlTab.addEventListener('click', function(e) {
            e.preventDefault();
            urlForm.classList.remove('hidden');
            manualForm.classList.add('hidden');
            urlTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'font-medium');
            urlTab.classList.remove('text-gray-500', 'hover:text-gray-700');
            manualTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'font-medium');
            manualTab.classList.add('text-gray-500', 'hover:text-gray-700');
        });
        
        manualTab.addEventListener('click', function(e) {
            e.preventDefault();
            manualForm.classList.remove('hidden');
            urlForm.classList.add('hidden');
            manualTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'font-medium');
            manualTab.classList.remove('text-gray-500', 'hover:text-gray-700');
            urlTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'font-medium');
            urlTab.classList.add('text-gray-500', 'hover:text-gray-700');
        });

        // Image preview functionality
        const fileUpload = document.getElementById('file-upload');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const uploadPrompt = document.getElementById('upload-prompt');
        const removeImage = document.getElementById('remove-image');

        fileUpload.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.setAttribute('src', e.target.result);
                    imagePreview.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

        removeImage.addEventListener('click', function() {
            fileUpload.value = '';
            imagePreview.classList.add('hidden');
            uploadPrompt.classList.remove('hidden');
        });
    });
</script>
{% endblock %}
{% endblock %}
